{% extends "base.html" %}
{% block title %}HOME | Timetable Recommender{% endblock %}
{% block content %}

    <!-- Hero / Main Banner -->
    <section class="relative overflow-hidden rounded-2xl border bg-white">
        <div class="grid md:grid-cols-2">
            <div class="p-8 md:p-12 flex flex-col gap-6">
                <span class="inline-flex items-center text-xs font-semibold tracking-widest uppercase text-gray-500">Beta</span>
                <h1 class="text-3xl md:text-5xl font-extrabold leading-tight">
                    ì§œìš”ì§œìš”
                    <!-- <span class="whitespace-nowrap">ë‚˜ë§Œì˜ ì‹œê°„í‘œ</span>ë¥¼ ì™„ì„±í•˜ì„¸ìš” -->
                </h1>
                <p class="text-gray-600">
                í•™ê³¼ ì»¤ë¦¬í˜ëŸ¼, ì „ê³µ/êµì–‘, ìµœì•  êµìˆ˜, ê°•ì˜ ê³„íšì„œê¹Œì§€ ë°˜ì˜í•œ ë§ì¶¤ ì‹œê°„í‘œ. ê²°ê³¼ê°€ ë§ìœ¼ë©´ AIê°€ ë˜‘ë˜‘í•˜ê²Œ Topâ€‘Nì„ ì¶”ì²œí•©ë‹ˆë‹¤.
                </p>
                <div class="flex gap-3">
                    <a href="/recommend" class="px-5 py-3 rounded-xl bg-black text-white hover:bg-gray-800">ì‹œê°„í‘œ ì¶”ì²œ ì‹œì‘</a>
                    {% if not user %}
                    <a href="/signup" class="px-5 py-3 rounded-xl border hover:bg-gray-50">íšŒì›ê°€ì…</a>
                    {% endif %}
                </div>
                <ul class="mt-2 grid grid-cols-2 gap-2 text-sm text-gray-600">
                    <li>âœ“ ê°•ì˜ ê³„íšì„œê¹Œì§€ ì›í´ë¦­ í™•ì¸</li>
                    <li>âœ“ í•™ê³¼ ì»¤ë¦¬í˜ëŸ¼ì„ ë°˜ì˜ </li>
                    <li>âœ“ ì°œ(ê³ ì •) ê³¼ëª© ë°˜ì˜</li>
                    <li>âœ“ ì‹œê°„í‘œ ì¥ë°”êµ¬ë‹ˆ</li>
                    <li>âœ“ AI Topâ€‘N ì¶”ì²œ</li>
                </ul>
            </div>
            <div class="relative bg-gradient-to-br from-gray-900 to-gray-700 text-white">
                <svg aria-hidden class="absolute inset-0 w-full h-full opacity-20" preserveAspectRatio="none" viewBox="0 0 600 600">
                    <defs>
                        <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
                            <stop offset="0%" stop-color="white"/>
                            <stop offset="100%" stop-color="transparent"/>
                        </linearGradient>
                    </defs>
                    <rect width="600" height="600" fill="url(#g)"/>
                </svg>
            
                <div class="p-8 md:p-12 flex items-center justify-center">
                    <div class="bg-white/10 backdrop-blur rounded-xl p-6 shadow-xl w-full max-w-md">
                        <div class="text-sm opacity-90 mb-2">ì¶”ì²œ ë¯¸ë¦¬ë³´ê¸°</div>
                        <div class="bg-white text-gray-900 rounded-lg overflow-hidden">
                            <table class="w-full text-sm">
                                <thead class="bg-gray-100 text-left">
                                    <tr>
                                        <th class="p-2">ê³¼ëª©</th>
                                        <th class="p-2">ìš”ì¼</th>
                                        <th class="p-2">ì‹œê°„</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr class="border-t"><td class="p-2">ìë£Œêµ¬ì¡°</td><td class="p-2">ì›”/ìˆ˜</td><td class="p-2">10:30â€‘11:45</td></tr>
                                    <tr class="border-t"><td class="p-2">í™•ë¥ ê³¼í†µê³„</td><td class="p-2">í™”/ëª©</td><td class="p-2">12:00â€‘13:15</td></tr>
                                    <tr class="border-t"><td class="p-2">ì»´í“¨í„°ë¹„ì „</td><td class="p-2">ê¸ˆ</td><td class="p-2">14:00â€‘16:45</td></tr>
                                </tbody>
                            </table>
                        </div>
                        <p class="mt-3 text-xs opacity-80">* ì‹¤ì œ ì¶”ì²œì€ ì…ë ¥ ì¡°ê±´ì— ë”°ë¼ ë‹¬ë¼ì§‘ë‹ˆë‹¤.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- êµê³¼ê³¼ì •í‘œ ì„ íƒ -->
    <section id="curriculum-section" class="mt-10 bg-white rounded-xl border p-6 hidden">
        <h2 class="text-lg font-semibold mb-4">êµê³¼ê³¼ì •í‘œ ë‹¤ìš´ë¡œë“œ</h2>
        <div class="grid md:grid-cols-2 gap-4 mb-4">
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">í•™ê³¼ ì„ íƒ</label>
                <select id="department-select" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-black focus:border-transparent" onchange="onDepartmentChange()">
                    <option value="">ì „ì²´</option>
                    <option value="ì¸ê³µì§€ëŠ¥ê³µí•™ê³¼">ì¸ê³µì§€ëŠ¥ê³µí•™ê³¼</option>
                </select>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">êµê³¼ê³¼ì •í‘œ ì„ íƒ</label>
                <select id="curriculum-select" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-black focus:border-transparent" onchange="onCurriculumChange()">
                    <option value="">ì „ì²´</option>
                </select>
            </div>
        </div>
        <div id="curriculum-results" class="mt-4">
            <!-- ì„ íƒëœ êµê³¼ê³¼ì •í‘œ ëª©ë¡ì´ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ë¡œë“œë©ë‹ˆë‹¤ -->
        </div>
    </section>

    <!-- Secondary CTA cards -->
    <section class="mt-10 grid md:grid-cols-3 gap-4">
        <a href="/curriculum" class="block rounded-xl border bg-white p-5 hover:shadow-sm cursor-pointer">
            <h3 class="font-semibold">êµê³¼ê³¼ì •í‘œ</h3>
            <p class="text-sm text-gray-600">í•™ê³¼ë³„ êµê³¼ê³¼ì •í‘œë¥¼ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”</p>
        </a>
        <a href="/lecture-search" class="block rounded-xl border bg-white p-5 hover:shadow-sm">
            <h3 class="font-semibold">ê°•ì˜ê²€ìƒ‰</h3>
            <p class="text-sm text-gray-600">ê°•ì˜ ëª©ë¡ í™•ì¸, ê°•ì˜ëª… ê²€ìƒ‰, êµìˆ˜ëª… ê²€ìƒ‰</p>
        </a>
        <a href="/favorites" class="block rounded-xl border bg-white p-5 hover:shadow-sm">
            <h3 class="font-semibold">ì°œ ëª©ë¡</h3>
            <p class="text-sm text-gray-600">ê´€ì‹¬ ìˆëŠ” ê°•ì˜ë¥¼ ì €ì¥í•˜ê³  ê´€ë¦¬í•˜ì„¸ìš”</p>
        </a>
    </section>
{% endblock %}

{% block extra_scripts %}
<script>
// í•™ê³¼ ì„ íƒ ì‹œ êµê³¼ê³¼ì •í‘œ ë“œë¡­ë‹¤ìš´ ì±„ìš°ê¸°
function onDepartmentChange() {
    const department = document.getElementById('department-select').value;
    const curriculumSelect = document.getElementById('curriculum-select');
    const resultsDiv = document.getElementById('curriculum-results');
    
    // êµê³¼ê³¼ì •í‘œ ì„ íƒ ì´ˆê¸°í™” ë° ê²°ê³¼ ì´ˆê¸°í™”
    curriculumSelect.innerHTML = '<option value="">ì „ì²´</option>';
    resultsDiv.innerHTML = '';
    
    if (!department) {
        return;
    }
    
    // í•´ë‹¹ í•™ê³¼ì˜ êµê³¼ê³¼ì •í‘œ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸° (ì—°ë„ ë¬´ê´€)
    fetch(`/api/curriculum-pdfs?department=${encodeURIComponent(department)}`)
        .then(response => response.json())
        .then(data => {
            data.forEach(item => {
                const option = document.createElement('option');
                option.value = item.id;
                const yearSuffix = item.year ? ` (${item.year}í•™ë…„ë„)` : '';
                option.textContent = `${item.department_name} êµê³¼ê³¼ì •í‘œ${yearSuffix}`;
                curriculumSelect.appendChild(option);
            });
        })
        .catch(error => {
            console.error('Error:', error);
        });
}

// êµê³¼ê³¼ì •í‘œ ì„ íƒ ì‹œ ëª©ë¡ í‘œì‹œ
function onCurriculumChange() {
    const curriculumSelect = document.getElementById('curriculum-select').value;
    const department = document.getElementById('department-select').value;
    const resultsDiv = document.getElementById('curriculum-results');
    
    resultsDiv.innerHTML = '';
    
    if (!department || !curriculumSelect) {
        return;
    }
    
    // ì „ì²´ ì„ íƒì´ë©´ ëª¨ë“  êµê³¼ê³¼ì •í‘œ í‘œì‹œ
    if (curriculumSelect === '') {
        fetch(`/api/curriculum-pdfs?department=${encodeURIComponent(department)}`)
            .then(response => response.json())
            .then(data => {
                displayCurriculumResults(data);
            })
            .catch(error => {
                console.error('Error:', error);
            });
    } else {
        // íŠ¹ì • êµê³¼ê³¼ì •í‘œë§Œ í‘œì‹œ
        fetch(`/api/curriculum-pdfs?department=${encodeURIComponent(department)}`)
            .then(response => response.json())
            .then(data => {
                const filtered = data.filter(item => item.id == curriculumSelect);
                displayCurriculumResults(filtered);
            })
            .catch(error => {
                console.error('Error:', error);
            });
    }
}

// êµê³¼ê³¼ì •í‘œ ëª©ë¡ í‘œì‹œ
function displayCurriculumResults(curriculums) {
    const resultsDiv = document.getElementById('curriculum-results');
    
    if (curriculums.length === 0) {
        resultsDiv.innerHTML = '<div class="text-center text-gray-500 py-8">êµê³¼ê³¼ì •í‘œê°€ ì—†ìŠµë‹ˆë‹¤.</div>';
        return;
    }
    
    resultsDiv.innerHTML = curriculums.map(item => {
        const yearSuffix = item.year ? `(${item.year}í•™ë…„ë„)` : '';
        return `
            <div class="border rounded-lg p-4 mb-3 hover:bg-gray-50 transition-colors">
                <div class="flex justify-between items-center">
                    <div>
                        <h3 class="font-semibold text-lg">${item.department_name} êµê³¼ê³¼ì •í‘œ ${yearSuffix}</h3>
                        ${item.curriculum_name ? `<p class="text-sm text-gray-600 mt-1">${item.curriculum_name}</p>` : ''}
                    </div>
                    <button onclick="downloadCurriculumPdf(${item.id}, '${item.department_name}', '${item.year || ''}')" 
                            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 font-semibold">
                        ğŸ“¥ ë‹¤ìš´ë¡œë“œ
                    </button>
                </div>
            </div>
        `;
    }).join('');
}

// êµê³¼ê³¼ì •í‘œ PDF ë‹¤ìš´ë¡œë“œ
function downloadCurriculumPdf(curriculumId, departmentName, year) {
    const pdfUrl = `/api/pdf/department/${encodeURIComponent(departmentName)}?id=${curriculumId}`;
    window.open(pdfUrl, '_blank');
}

// êµê³¼ê³¼ì •í‘œ ì„¹ì…˜ í‘œì‹œ ë° ìŠ¤í¬ë¡¤
function showCurriculumSection(event) {
    event.preventDefault();
    const section = document.getElementById('curriculum-section');
    if (section) {
        // ìˆ¨ê²¨ì§„ ì„¹ì…˜ì„ í‘œì‹œ
        section.classList.remove('hidden');
        
        // ì„¹ì…˜ìœ¼ë¡œ ìŠ¤í¬ë¡¤
        setTimeout(() => {
            section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            // ìŠ¤í¬ë¡¤ í›„ ì•½ê°„ì˜ ë”œë ˆì´ë¥¼ ë‘ê³  í•˜ì´ë¼ì´íŠ¸ íš¨ê³¼ ì¶”ê°€
            setTimeout(() => {
                section.style.transition = 'box-shadow 0.3s ease';
                section.style.boxShadow = '0 10px 25px rgba(0, 0, 0, 0.15)';
                setTimeout(() => {
                    section.style.boxShadow = '';
                }, 1000);
            }, 300);
        }, 100);
    }
}
</script>
{% endblock %}